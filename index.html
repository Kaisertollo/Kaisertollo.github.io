<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.slim.min.js" integrity="sha256-a2yjHM4jnF9f54xUQakjZGaqYs/V1CYvWpoqZzC2/Bw=" crossorigin="anonymous"></script>
    
    <title>Document</title>
</head>
<body>
  <div class="container">
    <h1>Liste des paiements</h1>
    <form>
      <div class="mb-3">
        <label for="date" class="form-label">Date</label>
        <input type="date" class="form-control" id="date">
      </div>
      <div class="mb-3">
        <label for="montant" class="form-label">Montant</label>
        <input type="number" class="form-control" id="montant">
      </div>
      <div class="mb-3">
        <label for="heure" class="form-label">Heure</label>
        <input type="time" class="form-control" id="heure">
      </div>
      <button type="submit" class="btn btn-primary" id="ajouter">Ajouter</button>
    </form>
    <table id="paiementsTable" class="table table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Montant</th>
          <th>Heure</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    
  </div>
  <script type="module">
    class Paiement {
    constructor(date, montant, heure) {
      this.date = date;
      this.montant = montant;
      this.heure = heure;
    }
  }
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-analytics.js";
  import { getDatabase, ref, push,child, get ,set} from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js"
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBNdNdVWfBGJ5haN5hjLPjtz8jMwI4P9lo",
    authDomain: "mekka-project.firebaseapp.com",
    databaseURL: "https://mekka-project-default-rtdb.firebaseio.com",
    projectId: "mekka-project",
    storageBucket: "mekka-project.appspot.com",
    messagingSenderId: "895649364100",
    appId: "1:895649364100:web:7374f65515be66d538ead1",
    measurementId: "G-EQZYWNDHK9"
  };
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  // Initialize Realtime Database and get a reference to the service
  const database = getDatabase(app);
  const dbRef = ref(getDatabase());
  const paiements = [];
  get(child(dbRef, `posts/`)).then((snapshot) => {
  if (snapshot.exists()) {
    console.log(snapshot.val());
    let list = snapshot.val()
    for (const key in list) {
  if (list.hasOwnProperty(key)) {
    console.log(key);
    let p = list[key]
    console.log(p);
    paiements.push(new Paiement(p["date"], p["montant"], p["heure"]))
    updateTable()

  }
}
  } else {
    console.log("No data available");
  }
}).catch((error) => {
  console.error(error);
});


  
  
  
  const form = document.querySelector('form');
  const paiementsTable = document.querySelector('#paiementsTable tbody');
  
  form.addEventListener('submit', (e) => {
    e.preventDefault();
  
    const date = document.querySelector('#date').value;
    const montant = document.querySelector('#montant').value;
    const heure = document.querySelector('#heure').value;

    // Create a new Paiement object
    const paiement = new Paiement(date, montant, heure);
    
    // Add the paiement to the array
    paiements.push(paiement);
  // Create a new post reference with an auto-generated id
  const db = getDatabase();
  const paiementRef = ref(db, 'posts');
  const newPaiementRef = push(paiementRef);
  set(newPaiementRef, paiement);
    // Clear the form
    form.reset();
    
    // Update the table
    updateTable();
    });
    
    function updateTable() {
    // Clear the table body
    paiementsTable.innerHTML = '';
    console.log(paiements)
    // Loop through the paiements array and add each one to the table
    paiements.forEach((paiement) => {
    const tr = document.createElement('tr');
    
    const dateTd = document.createElement('td');
    dateTd.textContent = paiement.date;
    tr.appendChild(dateTd);
    
    const montantTd = document.createElement('td');
    montantTd.textContent = paiement.montant;
    tr.appendChild(montantTd);
    
    const heureTd = document.createElement('td');
    heureTd.textContent = paiement.heure;
    tr.appendChild(heureTd);
    
    paiementsTable.appendChild(tr);
    });
    }
    
    // Call the updateTable function to initialize the table
    updateTable();      
  </script>
</body>
</html>